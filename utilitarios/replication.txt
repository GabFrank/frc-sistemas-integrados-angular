-- pasos para crear replicas en base de datos
-- configurar en ambos /var/lib/pgsql/13/data/postgresql.conf

sudo echo "wal_level = logical" | sudo tee -a /var/lib/pgsql/13/data/postgresql.conf && sudo systemctl restart postgresql-13
psql -U franco -p 5551 general -c "create publication filial5_pub for all tables" && sudo systemctl restart postgresql-13
psql -U franco -p 5551 postgres -c "create database filialDev"
psql -U franco -p 5552 -h localhost filial_dev_bkp -c "create subscription filialdevsub connection 'dbname=filialdev host=localhost user=franco password=franco port=5432' publication filialdevsub"

- eliminar subscription
-- buscar la subscription
psql -U franco filial1 -p 5551 -c "SELECT * FROM pg_stat_subscription;"
psql -U franco filial_dev_bkp -p 5551 -c "ALTER SUBSCRIPTION filial5_bkp_sub DISABLE;"
psql -U franco filial_dev_bkp  -c "SELECT pg_drop_replication_slot('filial5_bkp_sub');"
psql -U franco filial_dev_bkp  -c "ALTER SUBSCRIPTION filial5_bkp_sub SET (slot_name = NONE);"
psql -U franco filial_dev_bkp -p 5551 -c "DROP SUBSCRIPTION filial5_bkp_sub;"

-- buscar publicacion 
psql -U franco general -p 5551 -c "SELECT * FROM pg_publication;"

psql -U franco -p 5554 -h localhost filialdev -c "create subscription filial_dev_sub connection 'dbname=filial_dev_bkp host=localhost user=franco password=franco port=5552' publication filial_dev_bkp_pub"
psql -U franco -h localhost -p 5552 filial_dev_bkp -c "create publication filial_dev_bkp_pub for all tables" && sudo systemctl restart postgresql-13

CREATE SUBSCRIPTION filial5_bkp_sub
CONNECTION 'dbname=filial5 host=host.docker.internal user=franco password=franco port=5553'
PUBLICATION filial5_pub WITH (copy_data = false, origin = 'none');

CREATE SUBSCRIPTION filial5_sub
CONNECTION 'dbname=filial5_bkp host=host.docker.internal user=franco password=franco port=5552'
PUBLICATION filial5_bkp_pub WITH (copy_data = false, origin = NONE);

Lista de entidades que se necesitan modificar la propagacion
- Producto - ok
- Familia - ok
- Subfamilia - ok
- usuario - ok
- presentacion - ok
- producto por sucursal - ok
- pdv grupos productos - ok
- pdv grupos - ok
- salida_item
- entrada_item
- costo por producto - ok
- movimiento stock - ok
- producto proveedor - ok
- compra
- compra item
- pedido item
- venta item
- inventario - ok
- inventario producto - ok
- producto imagen
- codigo - ok
- codigo tipo precio - ok
- tipo precio - ok
- moneda - ok
- pdv categoria - ok
- precio por sucursla - ok
- programar precio - ok
- transferencia - ok
- transferencia item - ok
- inventario producto item - ok
- tipo presentacion - ok
- factura legal - ok
- factura legal item - ok
- cargo - ok
- tipo gasto - ok
- gasto - ok
- punto de venta - ok
- timbrado - ok
- timbrado detalle - ok
- sector - ok
- zona - ok
- local - ok
- autorizacion
- inicio sesion
- ciudad - ok
- funcionario - ok
- pdv caja - ok
- banco - ok
- cuenta bancaria - ok
- cambio - ok
- sencillo detalle
- movimiento caja - ok
- cliente - ok
- cambio caja - ok
- conteo - ok
- conteo moneda
- moneda billetes
- documento
- nota recepcion
- venta
- forma pago - ok
- cobro
- cobro detalle
- maletin - ok
- movimiento personas - ok
- retiro
- retiro detalle
- venta credito - ok
- venta credito cuota
- barrio - ok
- contacto - ok
- pais - ok
- proveedor - ok
- vendedor - ok
- movimiento stock - ok
- grupo role
- persona
- role
- usuario grupo
- usuario role
- 
